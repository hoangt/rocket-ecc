set -ex

CURVE="p256k1"
DIGEST="6b5dfcd5031a5fd18d9298421dfcf2da5320bea8524b26d2ca1419777207f2ea"
PUBKEY="044714D3011E0A0C10FAAFBF8E3E7109D4EE0C889708150D996E6DC09EDD8BCA4B7E65F63547156D9CC05A5F49DBA480006B527C5E44EC671215788C6CB3A46133"
PRIVKEY="0A01234E84E76FC75742E77BAD86E6C04053193CD5A48577E69E63695E7A96F6"
RP="3F4405D3189736967903DE12D420F7F586057EA358369071D4109066AF86E760"
KINV="0793F63668976C89189BDADA502E4BE1344DDD11C37D2AA30EBF66003605A77B"
R="3F4405D3189736967903DE12D420F7F586057EA358369071D4109066AF86E760"
S="65D5BFF43B205C90849AB4F926D13FCA097A4A443A596F25EA719082647FF817"

function verify()
{
    out="$($PTEST_BINARY --curve $CURVE --pubkey $PUBKEY --privkey $PRIVKEY --digest $DIGEST --rp $RP --kinv $KINV)"
    echo $out

    r="$(echo "$out" | grep "^--r" | cut -d' ' -f2)"
    s="$(echo "$out" | grep "^--s" | cut -d' ' -f2)"

    if [[ "$r" != "$R" ]]
    then
        exit 1
    fi

    if [[ "$s" != "$S" ]]
    then
        exit 1
    fi
}

trap verify EXIT
